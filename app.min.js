const express=require("express"),app=express();app.use(express.json());const mongoose=require("mongoose"),Book=require("./models/Book");mongoose.connect("mongodb+srv://nicolasmadier_db_user:RFkYOlKZJdDbFufS@cluster0.ufu3rkl.mongodb.net/?appName=Cluster0").then((()=>console.log("Connexion à MongoDB réussie !"))).catch((()=>console.log("Connexion à MongoDB échouée !"))),app.use(((req,res,next)=>{res.setHeader("Access-Control-Allow-Origin","*"),res.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content, Accept, Content-Type, Authorization"),res.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, PATCH, OPTIONS"),next()})),app.get("/api/books",((req,res,next)=>{Book.find().then((books=>{res.status(200).json(books),console.log(books)})).catch((error=>res.status(400).json({error:error})))})),app.get("/api/books/:id",((req,res,next)=>{Book.findOne({_id:req.params.id}).then((book=>res.status(200).json(book))).catch((error=>res.status(404).json({error:error})))})),app.post("/api/books",((req,res,next)=>{delete req.body._id;new Book({...req.body}).save().then((()=>res.status(201).json({message:"Livre enregistré !"}))).catch((error=>res.status(400).json({error:error})))})),app.put("/api/books/:id",((req,res,next)=>{Thing.updateOne({_id:req.params.id},{...req.body,_id:req.params.id}).then((()=>res.status(200).json({message:"Objet modifié !"}))).catch((error=>res.status(400).json({error:error})))})),app.delete("/api/books/:id",((req,res,next)=>{Book.deleteOne({_id:req.params.id}).then((()=>res.status(200).json({message:"Livre supprimé !"}))).catch((error=>res.status(400).json({error:error})))})),app.put("/api/books/:id",((req,res,next)=>{Book.updateOne({_id:req.params.id},{...req.body,_id:req.params.id}).then((()=>res.status(200).json({message:"Livre modifié !"}))).catch((error=>res.status(400).json({error:error})))})),module.exports=app;